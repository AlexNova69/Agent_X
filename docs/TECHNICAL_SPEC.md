# Полное техническое задание (ТЗ)

Проект: **Android‑приложение «Персональный AI‑агент контроля тела и активности»**

## 1. Общие положения

- **Платформа:** Android 9+
- **Язык:** Kotlin
- **Архитектура:** MVVM
- **UI:** Jetpack Compose
- **Хранение данных:** Room (локально) + Backend (облако)
- **Тип приложения:** Health / Lifestyle / AI Assistant

## 2. Основная функциональность

### 2.1 Пользовательские данные

- Рост (см)
- Пол
- Возраст
- Цель:
  - дефицит
  - поддержание
  - набор
- Целевая калорийность (авто / вручную)

### 2.2 Отслеживаемые параметры

| Параметр | Источник | Частота |
| --- | --- | --- |
| Вес | ручной ввод | 1 раз утром |
| Калории | ручной / API | в течение дня |
| Шаги | Google Fit | автоматически |
| Активность | Google Fit | автоматически |

## 3. Функциональные требования

### 3.1 Главный экран

- Текущая дата
- Вес сегодня
- Калории: потреблено / цель
- Активность (шаги)
- Индикатор статуса дня:
  - зеленый — норма
  - желтый — отклонение
  - красный — критично

### 3.2 Экран AI‑агента

- Текстовые рекомендации
- История сообщений
- Контекст: день, неделя

### 3.3 Ввод данных

- Быстрый ввод веса
- Добавление еды (калории)
- Коррекция активности (при необходимости)

### 3.4 Уведомления

- 07:00 — утренний чек‑ин
- 13:00–16:00 — корректирующие рекомендации
- 21:00 — итог дня

## 4. Нефункциональные требования

- Запуск < 2 сек
- Работа в фоне
- Без рекламы (MVP)
- Без медицинских диагнозов (важно для Google Play)

## 5. Ограничения и MVP‑границы

### Входит в MVP

- Регистрация профиля пользователя (локально + облако).
- Ежедневный сбор веса/калорий/шагов/активности.
- Рекомендации на основе правил (без персонализированного обучения модели).
- 3 типа уведомлений по расписанию.

### Не входит в MVP

- Медицинские рекомендации и диагностика.
- Интеграции с умными весами/датчиками кроме Google Fit.
- Социальные функции и соревнования.
- Поддержка iOS.

---

# Шаг 2. Логика AI‑агента (псевдокод + правила)

## 1. Основные принципы

- Агент не наказывает
- Агент не дает медицинских советов
- Агент адаптируется
- Фокус на действия, а не цифры

## 2. Ключевые метрики

- `avg_weight_7d`
- `calorie_balance_today`
- `activity_index_today`
- `trend_weight_7d`

## 3. Псевдокод анализа

```
IF morning_checkin:
    delta_weight = today_weight - avg_weight_7d

    IF delta_weight > +0.5:
        recommend("Вероятна задержка воды. Не режем калории.")
    ELSE IF delta_weight < -0.5:
        recommend("Вес снижается быстрее нормы. Контролируем дефицит.")
    ELSE:
        recommend("Вес в рабочем диапазоне.")

IF daytime_check:
    IF calories < expected_by_time AND activity < expected:
        recommend("Добавь перекус + 10–15 мин ходьбы.")
    IF calories > expected AND activity low:
        recommend("Калории выше нормы — компенсируем движением.")

IF evening_summary:
    IF calorie_balance OK AND activity OK:
        recommend("Отличный день. Фиксируем результат.")
    ELSE:
        recommend("Завтра скорректируем стратегию.")
```

## 4. Тональность агента

- Короткие фразы
- Уверенный, спокойный стиль
- Без эмодзи
- Без мотивационного пафоса

## 5. Правила реакции агента (таблица)

| Ситуация | Условие | Ответ агента |
| --- | --- | --- |
| Утренний чек‑ин | `delta_weight > +0.5` | «Вероятна задержка воды. Не режем калории.» |
| Утренний чек‑ин | `delta_weight < -0.5` | «Вес снижается быстрее нормы. Контролируем дефицит.» |
| Утренний чек‑ин | иначе | «Вес в рабочем диапазоне.» |
| Дневная проверка | `calories < expected_by_time` и `activity < expected` | «Добавь перекус + 10–15 мин ходьбы.» |
| Дневная проверка | `calories > expected` и `activity low` | «Калории выше нормы — компенсируем движением.» |
| Итог дня | `calorie_balance OK` и `activity OK` | «Отличный день. Фиксируем результат.» |
| Итог дня | иначе | «Завтра скорректируем стратегию.» |

---

# Шаг 3. Tech stack + Backend

## 1. Android (Frontend)

- Kotlin
- Jetpack Compose
- Hilt (DI)
- Room
- WorkManager
- Google Fit API

## 2. Backend (рекомендуемая схема)

**Вариант: Python + FastAPI**

- FastAPI
- PostgreSQL
- Redis (кэш рекомендаций)
- OpenAI / LLM API
- JWT авторизация

### API эндпоинты

- `POST /user/profile`
- `POST /daily/data`
- `GET  /recommendations/today`
- `GET  /analytics/week`

## 3. Хранение данных

- **Локально:** быстрый доступ
- **Облако:**
  - история
  - обучение рекомендаций
  - перенос между устройствами

## 4. Безопасность

- HTTPS
- Минимум персональных данных
- Возможность полного удаления профиля

## 5. Модель данных (MVP)

### Room (локально)

- `UserProfile`:
  - `id` (UUID)
  - `height_cm` (Int)
  - `gender` (Enum)
  - `age` (Int)
  - `goal` (Enum: deficit/maintain/bulk)
  - `target_calories` (Int, nullable)
  - `auto_calories` (Boolean)
- `DailyMetrics`:
  - `date` (LocalDate, primary key)
  - `weight_kg` (Float, nullable)
  - `calories_in` (Int, default 0)
  - `steps` (Int, default 0)
  - `activity_minutes` (Int, default 0)
- `AgentMessage`:
  - `id` (UUID)
  - `date_time` (Instant)
  - `context` (Enum: morning/day/evening/week)
  - `text` (String)
  - `user_action` (Enum: ok/explain/ignore, nullable)

### Облако

- Хранит синхронизированную историю по пользователю.
- Признак удаленного удаления профиля.

## 6. Синхронизация и офлайн‑режим

- Запись данных в Room сразу после ввода.
- Отправка в облако через WorkManager при наличии сети.
- Конфликт дат: приоритет последней локальной правки, сервер ведет историю версий.

---

# Шаг 4. UX / структура экранов

## 1. Навигация (нижняя панель)

- Сегодня
- Агент
- Ввод
- История
- Настройки

## 2. Экран «Сегодня»

Карточки:

- Вес
- Калории
- Активность
- Статус дня (1 фраза от агента)

### Пустые состояния

- Нет веса: кнопка «Добавить вес».
- Нет данных Google Fit: подсказка с переходом к выдаче разрешений.

## 3. Экран «Агент»

- Диалог в формате чата
- Агент пишет первым
- Возможность:
  - «Ок»
  - «Поясни»
  - «Игнорировать»

### UX‑правила чата

- Сообщение агента ограничено 1–2 короткими предложениями.
- Вечерний итог закрепляется вверху до следующего дня.

## 4. Экран «История»

- График веса (7 / 30 дней)
- График калорий
- Комментарии агента по дням

### Фильтры

- 7 дней / 30 дней / 90 дней.

## 5. Настройки

- Цель
- Калорийность
- Частота уведомлений
- Стиль агента:
  - строгий
  - нейтральный
  - поддерживающий

### Дополнительные настройки

- Выбор единиц веса (кг/фунты).
- Экспорт данных (CSV).

---

# Итог

Это не просто приложение, а:

- персональный цифровой коуч,
- минимальный ввод данных,
- решения на основе контекста,
- масштабируемая архитектура.
